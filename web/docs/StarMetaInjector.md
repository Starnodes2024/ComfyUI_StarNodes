# ⭐ Star Meta Injector

Transfers all PNG metadata (including ComfyUI workflow data) from a source image to a target image and saves it directly, making it easy to share workflows with custom images.

- __Category__: `⭐StarNodes/Image And Latent`
- __Class__: `StarMetaInjector`
- __File__: `star_meta_injector.py`

## Overview

The Star Meta Injector node extracts all metadata from a source PNG file and injects it into a target image, then saves the result directly. This ensures the metadata is properly preserved and not overwritten by ComfyUI's workflow system.

## Use Cases

- **Share workflows with custom images**: Generate an image with ComfyUI, then inject its workflow metadata into a different image for sharing
- **Preserve workflow data**: Keep workflow information when replacing images
- **Metadata management**: Transfer generation parameters, prompts, and settings between images

## Why It Saves Directly

If you connect this node to a standard Save Image node, ComfyUI will overwrite the injected metadata with the current workflow. By saving directly, the node ensures the source image's metadata is preserved.

---

## Inputs

- __target_image__ (IMAGE, required): The image that will receive the metadata and be saved
- __source_image_path__ (STRING, required): Path to source PNG file with metadata to copy (e.g., `output/ComfyUI_00001_.png`)
- __filename_prefix__ (STRING, optional, default: "ComfyUI"): Prefix for the output filename

## Outputs

This is an output node that saves images directly. The saved image will appear in ComfyUI's preview.

## Metadata Transferred

The node copies all PNG text chunks from the source file, including:
- **workflow**: ComfyUI workflow JSON
- **prompt**: Generation prompt data
- **parameters**: Generation parameters
- **custom fields**: Any other metadata stored in the PNG

## Technical Details

### How It Works
1. Reads all PNG text chunks from the source file
2. Converts the target image tensor to PIL Image format
3. Attaches metadata to the image
4. Saves the image directly with `pnginfo` parameter to ensure metadata is written

### Supported Formats
- **Source**: PNG files with embedded metadata
- **Target**: Any ComfyUI IMAGE tensor
- **Output**: PNG with embedded metadata

## Example Workflow

1. **Generate a test image** with your ComfyUI workflow → Saved as `output/ComfyUI_00001_.png` (contains workflow metadata)
2. **Load your custom image** (the one you want to share) using Load Image node
3. **Connect to Star Meta Injector**:
   - `target_image`: Your custom image
   - `source_image_path`: `output/ComfyUI_00001_.png`
   - `filename_prefix`: `MySharedWorkflow`
4. **Run the workflow** → Your custom image is saved as `MySharedWorkflow_00001_.png` with the workflow embedded
5. **Share the result** → Anyone can load it in ComfyUI and see your workflow!

## Troubleshooting

### "No metadata found to inject"
- Ensure `source_image_path` points to a valid PNG file
- Check that the source PNG actually contains metadata (generated by ComfyUI)
- Verify the file path is correct and accessible

### Metadata not preserved
- The node saves directly to prevent metadata from being overwritten
- Don't connect this node to another Save Image node - it saves automatically
- The saved image will appear in ComfyUI's output preview

### "Source file not found"
- Verify the path in `source_image_path` is correct
- Use absolute paths or paths relative to ComfyUI root
- Check file permissions

## Version
- Introduced in StarNodes 1.9.3+

## Related Nodes
- Save Image (ComfyUI built-in)
- Load Image (ComfyUI built-in)
- Star Image Loader 1by1

## Tips
- The source file must be a PNG with embedded metadata (generated by ComfyUI)
- The node saves to ComfyUI's standard output directory
- Filenames are auto-incremented to prevent overwrites (e.g., `ComfyUI_00001_.png`, `ComfyUI_00002_.png`)
- Use this node to create "template" images with reusable workflows
- Perfect for sharing workflows with custom preview images
